<!DOCTYPE html>
<html>
  <head>
    <style>
      body {font-size: 20px;}
      input {font-size: 20px;}
      button {font-size: 20px;}
      th {font-size: 20px; font-weight: bold;}
      .column {float: left; width: 60%;}

      /* Clear floats after the columns */
      .row:after {content: ""; display: table; clear: both;}
    </style>
    <title>Breathing</title>
  </head>
  <body>
    <script src="./speechSynthesis.js"></script>
    <script>
    function log(message) {
      document.getElementById('log').value += message + '\n';
    }
    
    var t1;
    var t2;
    var spoke1;
    var spoke2;
      
    function loop() {
      log('loop');
      var repeat = document.getElementById('repeat').value;
      var r1 = document.getElementById('range1').value;
      var r2 = document.getElementById('range1').value;
      init();
      var interval = setInterval(updateState, 1000); 
    }
    
    function init() {
      t1 = new Date();
      t2 = new Date();
      t1.setSeconds( t1.getSeconds() + r1 );
      t2.setSeconds( t2.getSeconds() + r1 + r2 );
      spoke1 = false;
      spoke2 = false;
    }
      
    function updateState() {
      log('updateState repeat=' + repeat + ' spoke1=' + spoke1 + ' spoke2=' + spoke2);
      var now = new Date();
      log('now=' + now + ' t1=' + t1);
      if (repeat < 1) clearInterval(interval);
      if (!spoke1) {
        say('inhale');
        spoke1 = true;
      }
      
      if (!spoke2 && now > t1) {
        say('exhale');
        spoke2 = true;
      }
      
      if (now > t2) {
        repeat--;
        init();  
      }
    }
    
    function updateLabel(id, val) {
      document.getElementById(id).innerHTML=val; 
    }
      
    function fillCell(id, percent) {
      var canvas = document.getElementById(id);      
      var ctx = canvas.getContext('2d');
      ctx.rect(0, 0, 300 * percent, canvas.height);
      ctx.fillStyle = 'blue';
      ctx.fill();
    }
    
      log('repeat=' + document.getElementById('repeat').value);
      log('inhale=' + document.getElementById('range1').value);
    </script>
    <div class="row">
      <div class="column">
    <h1>Breathing</h1><br/>
    Repeat <input size="2" type="text" id="repeat" value="5"> <button onclick="loop()">Go</button><br/>
    <br/><br/>
    <table>
      <tr>
        <th>Phrase</th><th>Duration</th><th>*</th><th>Countdown</th>
      </tr>
      <tr>
        <td><input id="inhale" type="text" value="Inhale"></td>
        <td><input type="range" min="1" max="10" value="4" id="range1" onchange="updateLabel('label1',this.value);"></td>
        <td><label id="label1">4</label></td>
        <td><canvas id="canvas1" width="300" height="10"></canvas></td>
      </tr>
      <tr>
        <td><input id="exhale" type="text" value="Exhale"></td>
        <td><input type="range" min="1" max="10" value="4" id="range2" onchange="updateLabel('label2',this.value);"></td>
        <td><label id="label2">4</label></td>
        <td><canvas id="canvas2" width="300" height="10"></canvas></td>
      </tr>
     </table>
      </div>
      <div class="column">
        <br/><br/><br/><br/><br/><br/>
        <textarea id="log" rows="50" cols="50"></textarea>
      </div>
  </body>
</html>
